#!/usr/bin/env bash
#------------------------------------------------------------------------------
# Copyright (c) 2011-2013, Think Big Analytics, Inc. All Rights Reserved.
#------------------------------------------------------------------------------
# waiting - Used to sleep for a specified period of time and logging

thisdir=$(dirname $BASH_SOURCE)
. $thisdir/common.sh

if [[ "$1" =~ --?h.* ]]
then
  cat <<EOF
$0 - Sleep for a period of time and (occasionally) log a message that you're waiting.

Usage: $0 tries_so_far sleep_interval [text]

Where:
  tries_so_far    The number of times that $0 has been called. 
                  Used to format the log message.
  sleep_interval  The time to sleep. Format is "Nx".
                  See "to-seconds --help" for the required format.
  text            All other arguments are part of the text that is logged.
EOF
exit 0
fi

tries=$1
shift
sleep_interval=$1
shift

if [ $tries -le 5 -o $(expr $tries % 5) = 0 ]
then
  let seconds=$tries*$(to-seconds $sleep_interval)
  info "$@ (waiting $seconds seconds so far)"
fi
sleep $sleep_interval

