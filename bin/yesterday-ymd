#!/usr/bin/env bash
#------------------------------------------
# yesterday-ymd - Return a YYYYMMDD string for YESTERDAY's date

thisdir=$(dirname $BASH_SOURCE)
. $thisdir/common.sh

if [[ "$1" =~ --?h.* ]]
then
  cat <<EOF
yesterday-ymd - Return a YYYYMMDD string for YESTERDAY's date
Uses the values for $YEAR, $MONTH, and $DAY as TODAY's date.
usage: yesterday-ymd [delimiter | --as-args]
An optional delimiter can be specified as the single argument.
Or, if "--as-args" is specified, the output is
    --year=YYYY --month=MM --day=DD
which can be used to invoke stampede.
EOF
exit 0
fi

case $1 in
  --as-args)    
    $thisdir/dates --date "$(ymd)" --informat '%Y%m%d' --format '%Y %m %d' -1:-1 d | while read y m d
    do
      echo "--year=$y --month=$m --day=$d"
    done
    ;;
  *)
    delimiter=$1
    fmt="%Y$delimiter%m$delimiter%d"
    $thisdir/dates --date "$(ymd "$delimiter")" --informat "$fmt" --format "$fmt" -1:-1 d
    ;;
esac
