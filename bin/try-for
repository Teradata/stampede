#!/usr/bin/env bash
#------------------------------------------------------------------------------
# Copyright (c) 2011-2013, Think Big Analytics, Inc. All Rights Reserved.
#------------------------------------------------------------------------------
# try-for - Wait for an expression to succeed for a specified time period from now.

thisdir=$(dirname $BASH_SOURCE)
. $thisdir/common.sh

if [[ "$1" =~ --?h.* ]]
then
  cat <<EOF
$0 - Wait for an expression to succeed for a specified time period from now.

Usage: $0 time_duration time_between_attempts expression

Where:
  time_duration          How much time to keep trying the expression before 
                         giving up. After this point in time, a failure status
                         of 1 is returned. Format is "Nx". See "to-seconds --help"
                         for the required format of this argument.
  time_between_attempts  How long to wait between attempts. Format is "Nx".
                         See "to-seconds --help" for the required format.
  expression             The remaining arguments are the bash expression to try on
                         every iteration. It must return a status of 0 when evaluated
                         to indicate success and nonzero for failure. For example,
                         "ls foo" returns 0 if "foo" exists, otherwise it returns 1.

Contrast with "try-for-or-die", "try-until", and "try-until-or-die".
NOTES: 
  1) The process will sleep between attempts.
  2) If you don't want the expression's output, redirect to "/dev/null".
EOF
exit 0
fi

_do_try_for 0 "$@"
