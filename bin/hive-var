#!/usr/bin/env bash
#------------------------------------------------------------------------------
# Copyright (c) 2011-2013, Think Big Analytics, Inc. All Rights Reserved.
#------------------------------------------------------------------------------
# hive-var - Show the value for one or more Hive variables or properties.

thisdir=$(dirname $BASH_SOURCE)
. $thisdir/common.sh

function help {
  cat <<EOF
$0 - Show the value for one or more Hive environment variables.

Usage: $0 [-h | --help] [--print-keys] [--all | string [string ...]]

Where:
  -h | --help    Show this message.
  --print-keys   Print all matching "key=value" pairs, rather than just "values".
  --all          Show ALL variables. Implies "--print-keys".
  string         All or part of the variable name.
EOF
exit 0
}

function show_vars {
  let print_keys=$1
  shift
  hive -e 'set -v;' 2> /dev/null | grep -v PREEXEC_CMD | while read line
  do
    for s in "$@"
    do
      if [[ $line =~ $s ]]
      then 
        if [ $print_keys -eq 0 ] 
        then
          echo $line
        else
          echo $line | sed -e 's/[^=]*=//' 
        fi
      fi
    done
  done
}

if [ $# -eq 0 ]
then
  echo "$0: ERROR: Must specify names or --all"
  help
  exit 1
fi

args=()
let print_keys=1
while [ $# -ne 0 ]
do
  case $1 in
    -h*|--h*)
      help
      exit 0
      ;;
    --a*)
      hive -e 'set -v;' 2> /dev/null
      exit 0
      ;;
    --p*)
      let print_keys=0
      ;;
    -*)
      echo "$0: ERROR: Unrecognized argument \"$1\"."
      help
      exit 1
      ;;
    *)
      args[${#args[@]}]=$(echo $1 | sed -e 's/\./\\./g')
      ;;
  esac
  shift
done

show_vars $print_keys "${args[@]}"
